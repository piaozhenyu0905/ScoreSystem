"use strict";(self["webpackChunkscoring_system_front"]=self["webpackChunkscoring_system_front"]||[]).push([[124],{41:function(e,a,t){t.d(a,{XD:function(){return i},_8:function(){return l},q6:function(){return r}});var n=t(5857);const i=(e,a)=>new Promise(((t,i)=>{(0,n.A)({method:"get",url:"/api/todolist",headers:{"Content-Type":"application/json"},params:{pageNum:e,pageSize:a}}).then((e=>{t(e)})).catch((e=>{i(e.response)}))})),l=()=>new Promise(((e,a)=>{(0,n.A)({method:"get",url:"/api/findAll",headers:{"Content-Type":"application/json"}}).then((a=>{e(a)})).catch((e=>{a(e.response)}))})),r=e=>new Promise(((a,t)=>{let i={userIds:e};(0,n.A)({method:"post",url:"/api/add/evaluated",headers:{"Content-Type":"application/json"},data:JSON.stringify(i)}).then((e=>{a(e)})).catch((e=>{t(e.response)}))}))},5124:function(e,a,t){t.r(a),t.d(a,{default:function(){return C}});t(9138);var n=t(5115),i=t(7296),l=t(9650),r=t(9675),o=t(3771),s=(t(3369),t(5857));const d=(e,a,t)=>new Promise(((n,i)=>{let l={name:t,pageNum:e,pageSize:a};(0,s.A)({method:"post",url:"/api/find/relationships",headers:{"Content-Type":"application/json"},data:JSON.stringify(l)}).then((e=>{n(e)})).catch((e=>{i(e.response)}))})),u=(e,a)=>new Promise(((t,n)=>{(0,s.A)({method:"post",url:"/api/add/relationship",headers:{"Content-Type":"application/json"},params:{evaluatorId:e,userId:a}}).then((e=>{t(e)})).catch((e=>{n(e.response)}))})),p=(e,a)=>new Promise(((t,n)=>{(0,s.A)({method:"delete",url:"/api/update/relationship",headers:{"Content-Type":"application/json"},params:{evaluatorId:e,userId:a}}).then((e=>{t(e)})).catch((e=>{n(e.response)}))})),c=e=>new Promise(((a,t)=>{let n=new FormData;n.append("file",e),(0,s.A)({method:"post",url:"/api/import/relationship",headers:{"Content-Type":"multipart/form-data"},data:n}).then((e=>{a(e)})).catch((e=>{t(e.response)}))})),m=()=>new Promise(((e,a)=>{(0,s.A)({method:"get",url:"/api/relation/step",headers:{"Content-Type":"application/json"}}).then((a=>{e(a)})).catch((e=>{a(e.response)}))}));var h=t(41),v=t(543);const y={class:"score-matrix"},g={class:"content-header"},k={class:"search-form"},f={class:"submit-Btn"},x={class:"content-table"},b={class:"actionBtn"};var w={__name:"ScoringMatrix",setup(e){const a=(0,r.KR)(!1),t=(0,r.KR)(),s=()=>{(0,v.Q)().then((e=>{if(200===e.data.code)for(let n=0;n<=e.data.data.evaluateStep.length-1;n++)1===e.data.data.evaluateStep[n].enable&&(t.value=n+1+"","1"===t.value?a.value=!1:a.value=!0);else o.Ay.error("获取失败！"+e.data.msg)})).catch((e=>{console.log("获取失败！",e)}))},w=(0,r.Kh)({name:null}),_=(0,r.KR)(null),F=()=>{C.current=1,L()},C=(0,r.Kh)({pageSize:12,current:1,total:0,showTotal:(e,a)=>`总共 ${e} 条数据`}),A=(0,r.KR)([{title:"序号",dataIndex:"index",key:"index",fixed:"left",align:"center",width:65},{title:"被评估人",dataIndex:"name",key:"name",fixed:"left",align:"center",width:100},{title:"主管1",dataIndex:"supervisorName1",key:"supervisorName1",align:"center",width:100},{title:"主管2",dataIndex:"supervisorName2",key:"supervisorName2",align:"center",width:100},{title:"主管3",dataIndex:"supervisorName3",key:"supervisorName3",align:"center",width:100},{title:"主管4",dataIndex:"supervisorName4",key:"supervisorName4",align:"center",width:100},{title:"固定评估人",dataIndex:"relationshipFixed",key:"relationshipFixed",align:"center"},{title:"自主评估人",dataIndex:"relationshipSelf",key:"relationshipSelf",align:"center"},{title:"操作",key:"action",fixed:"right",align:"center",width:160}]),I=(0,r.KR)([]),N=(0,r.KR)("60vh"),K=()=>{const e=window.innerHeight,a=e-50-10;N.value=e<800?.63*a+"px":.7*a+"px"},L=()=>{d(C.current,C.pageSize,w.name).then((e=>{if(200===e.data.code){C.total=e.data.data.total,I.value=[];for(let a=0;a<e.data.data.data.length;a++){const t=e.data.data.data[a].relationshipFixedList||[],n=e.data.data.data[a].relationshipSelfList||[],i=t.map((e=>e.name)).join("、"),l=n.map((e=>e.name)).join("、");I.value.push({index:C.current*C.pageSize-C.pageSize+a+1,userId:e.data.data.data[a].userId,name:e.data.data.data[a].name,supervisorName1:e.data.data.data[a].supervisorName1,supervisorName2:e.data.data.data[a].supervisorName2,supervisorName3:e.data.data.data[a].supervisorName3,supervisorName4:e.data.data.data[a].supervisorName4,relationshipFixedList:e.data.data.data[a].relationshipFixedList,relationshipSelfList:e.data.data.data[a].relationshipSelfList,relationshipFixed:i,relationshipSelf:l})}}})).catch((e=>{o.Ay.error("请求失败！",e)}))},S=e=>{C.current=Number(e.current),C.pageSize=e.pageSize,L()},R=(0,r.KR)(!1),W=(0,r.KR)([{title:"序号",dataIndex:"index",key:"index",width:"15%",align:"center"},{title:"用户名",dataIndex:"username",key:"username",align:"center"},{title:"工号",dataIndex:"jobuNumber",key:"jobuNumber",align:"center"},{title:"部门",dataIndex:"department",key:"department",align:"center"},{title:"操作",key:"action",width:"15%",align:"center"}]),j=(0,r.KR)([]),z=e=>{_.value=e.userId,j.value=[];for(let a=0;a<e.relationshipFixedList.length;a++)j.value.push({index:a+1,key:e.relationshipFixedList[a].id,username:e.relationshipFixedList[a].name,jobuNumber:e.relationshipFixedList[a].workNum,department:e.relationshipFixedList[a].department});R.value=!0},T=e=>{const a=j.value.findIndex((a=>a.key===e.key));p(e.key,_.value).then((e=>{200===e.data.code?(o.Ay.success("删除成功！"),-1!==a&&j.value.splice(a,1),L()):o.Ay.error("删除失败！",e.data.msg)})).catch((e=>{o.Ay.error("请求失败！",e)}))},X=(0,r.KR)(!1),P=()=>{D(),X.value=!0},B=(0,r.KR)(),E=(0,r.KR)([]),D=()=>{(0,h._8)().then((e=>{if(200===e.data.code){E.value=[{value:"空值",key:0}];for(let a=0;a<=e.data.data.length-1;a++)E.value.push({value:e.data.data[a].name+"("+e.data.data[a].department+")",key:e.data.data[a].userId,name:e.data.data[a].name})}else o.Ay.error("获取失败！"+e.data.msg)})).catch((e=>{o.Ay.error("请求失败！",e)}))},Q=()=>{u(B.value,_.value).then((e=>{200===e.data.code?(o.Ay.success("添加固定评估人成功！^_^"),B.value="",L(),X.value=!1,R.value=!1):o.Ay.error("添加固定评估人失败！"+e.data.msg)})).catch((e=>{console.log("请求失败！",e)}))},U=(0,r.KR)(null),O=(0,r.KR)(!1),J=()=>{U.value.click()},$=e=>{const a=e.target.files[0];a&&(O.value=!0,c(a).then((e=>{O.value=!1,200===e.data.code?(o.Ay.success("文件上传成功~ =• ֊ •="),setTimeout((()=>{location.reload()}),100)):o.Ay.error("文件上传失败，"+e.data.msg+"~Z☡zᶻ")})).catch((e=>{O.value=!1,o.Ay.error("文件上传失败"+e)})))},q=()=>{m().then((e=>{200===e.data.code?(o.Ay.success("您已发布本轮评估矩阵关系!"),a.value=!0):o.Ay.error("发布失败！"+e.data.msg)})).catch((e=>{o.Ay.error("请求失败！"+e)}))};return(0,n.sV)((()=>{L(),s(),K(),window.addEventListener("resize",K)})),(0,n.hi)((()=>{window.removeEventListener("resize",K)})),(e,t)=>{const r=(0,n.g2)("a-input"),o=(0,n.g2)("a-form-item"),s=(0,n.g2)("a-button"),d=(0,n.g2)("a-form"),u=(0,n.g2)("a-popconfirm"),p=(0,n.g2)("a-spin"),c=(0,n.g2)("a-table"),m=(0,n.g2)("a-modal"),h=(0,n.g2)("a-select-option"),v=(0,n.g2)("a-select");return(0,n.uX)(),(0,n.CE)("div",y,[(0,n.Lk)("div",g,[(0,n.Lk)("div",k,[(0,n.bF)(d,{style:{display:"flex","align-items":"center"}},{default:(0,n.k6)((()=>[(0,n.bF)(o,{style:{"margin-right":"10px",width:"300px"}},{default:(0,n.k6)((()=>[(0,n.bF)(r,{placeholder:"请输入被评估人姓名",value:w.name,"onUpdate:value":t[0]||(t[0]=e=>w.name=e),allowClear:!0},null,8,["value"])])),_:1}),(0,n.bF)(o,null,{default:(0,n.k6)((()=>[(0,n.bF)(s,{type:"primary",onClick:(0,i.D$)(F,["prevent"]),class:"seachBtn"},{default:(0,n.k6)((()=>t[5]||(t[5]=[(0,n.eW)("搜索")]))),_:1})])),_:1})])),_:1})]),(0,n.Lk)("div",f,[(0,n.bF)(s,{type:"primary",style:{"margin-right":"10px"},onClick:J},{default:(0,n.k6)((()=>t[6]||(t[6]=[(0,n.eW)("导入数据")]))),_:1}),(0,n.bF)(u,{placement:"bottom",title:"确定要发布本轮矩阵关系吗？","ok-text":"确定","cancel-text":"取消",onConfirm:t[1]||(t[1]=e=>q())},{default:(0,n.k6)((()=>[a.value?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.Wv)(s,{key:0,type:"primary",style:{"background-color":"#39ba06"}},{default:(0,n.k6)((()=>t[7]||(t[7]=[(0,n.eW)(" 发布 ")]))),_:1}))])),_:1}),a.value?((0,n.uX)(),(0,n.Wv)(s,{key:0,type:"primary",disabled:""},{default:(0,n.k6)((()=>t[8]||(t[8]=[(0,n.eW)(" 已发布 ")]))),_:1})):(0,n.Q3)("",!0),(0,n.Lk)("input",{ref_key:"fileInput",ref:U,type:"file",accept:".xls,.xlsx",style:{display:"none"},onChange:$},null,544),(0,n.bF)(p,{spinning:O.value,class:"loading-spin",size:"large"},null,8,["spinning"])])]),(0,n.Lk)("div",x,[(0,n.bF)(c,{columns:A.value,"data-source":I.value,rowKey:e=>e.key,scroll:{y:N.value},pagination:C,bordered:!0,onChange:S},{bodyCell:(0,n.k6)((({text:e,record:a,column:i})=>["action"===i.key?((0,n.uX)(),(0,n.Wv)(s,{key:0,type:"text",onClick:e=>z(a),style:{color:"#0014B7"}},{default:(0,n.k6)((()=>t[9]||(t[9]=[(0,n.eW)("修改固定评估人")]))),_:2},1032,["onClick"])):((0,n.uX)(),(0,n.CE)(n.FK,{key:1},[(0,n.eW)((0,l.v_)(e),1)],64))])),_:1},8,["columns","data-source","rowKey","scroll","pagination"]),(0,n.bF)(m,{open:R.value,"onUpdate:open":t[2]||(t[2]=e=>R.value=e),title:"修改固定评估人",footer:null},{default:(0,n.k6)((()=>[(0,n.bF)(c,{columns:W.value,"data-source":j.value,bordered:!0,pagination:!1,scroll:{y:"60vh"}},{bodyCell:(0,n.k6)((({column:e,record:a})=>["action"===e.key?((0,n.uX)(),(0,n.Wv)(u,{key:0,title:"确定要移除吗？","ok-text":"确定","cancel-text":"取消",onConfirm:e=>T(a)},{default:(0,n.k6)((()=>t[10]||(t[10]=[(0,n.Lk)("a",{style:{color:"#BD3124","font-weight":"bold"}}," 移除 ",-1)]))),_:2},1032,["onConfirm"])):(0,n.Q3)("",!0)])),_:1},8,["columns","data-source"]),(0,n.Lk)("div",b,[(0,n.bF)(s,{type:"primary",onClick:P},{default:(0,n.k6)((()=>t[11]||(t[11]=[(0,n.eW)("添加评估人")]))),_:1})])])),_:1},8,["open"]),(0,n.bF)(m,{open:X.value,"onUpdate:open":t[4]||(t[4]=e=>X.value=e),title:"添加评估人",onOk:Q},{default:(0,n.k6)((()=>[(0,n.bF)(v,{value:B.value,"onUpdate:value":t[3]||(t[3]=e=>B.value=e),placeholder:"请选择",style:{width:"100%"}},{default:(0,n.k6)((()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(E.value,(e=>((0,n.uX)(),(0,n.Wv)(h,{key:e.key,value:e.key},{default:(0,n.k6)((()=>[(0,n.eW)((0,l.v_)(e.value),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1},8,["open"])])])}}},_=t(2965);const F=(0,_.A)(w,[["__scopeId","data-v-3df7f0fc"]]);var C=F}}]);
//# sourceMappingURL=124.e4dc866b.js.map