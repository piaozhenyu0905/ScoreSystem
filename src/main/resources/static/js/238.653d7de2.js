"use strict";(self["webpackChunkscoring_system_front"]=self["webpackChunkscoring_system_front"]||[]).push([[238],{41:function(e,a,t){t.d(a,{AV:function(){return i},XD:function(){return r},_8:function(){return d},q6:function(){return l}});var n=t(5857);const r=(e,a)=>new Promise(((t,r)=>{(0,n.A)({method:"get",url:"/api/todolist",headers:{"Content-Type":"application/json"},params:{pageNum:e,pageSize:a}}).then((e=>{t(e)})).catch((e=>{r(e.response)}))})),d=()=>new Promise(((e,a)=>{(0,n.A)({method:"get",url:"/api/findAll",headers:{"Content-Type":"application/json"}}).then((a=>{e(a)})).catch((e=>{a(e.response)}))})),l=e=>new Promise(((a,t)=>{let r={userIds:e};(0,n.A)({method:"post",url:"/api/add/evaluated",headers:{"Content-Type":"application/json"},data:JSON.stringify(r)}).then((e=>{a(e)})).catch((e=>{t(e.response)}))})),i=()=>new Promise(((e,a)=>{(0,n.A)({method:"get",url:"/api/find/assessor",headers:{"Content-Type":"application/json"}}).then((a=>{e(a)})).catch((e=>{a(e.response)}))}))},238:function(e,a,t){t.r(a),t.d(a,{default:function(){return K}});t(9138),t(1531),t(3678),t(4145);var n=t(7616),r=t(5523),d=t(5929),l=t(3e3),i=t(1516),o=(t(3369),t(5857));const s=(e,a,t)=>new Promise(((n,r)=>{let d={name:t,pageNum:e,pageSize:a};(0,o.A)({method:"post",url:"/api/find/relationships",headers:{"Content-Type":"application/json"},data:JSON.stringify(d)}).then((e=>{n(e)})).catch((e=>{r(e.response)}))})),u=e=>new Promise(((a,t)=>{(0,o.A)({method:"get",url:"/api/matrix/relatedPersonInfo",headers:{"Content-Type":"application/json"},params:{userId:e}}).then((e=>{a(e)})).catch((e=>{t(e.response)}))})),c=(e,a)=>new Promise(((t,n)=>{let r={evaluatorIds:e,userId:a};(0,o.A)({method:"post",url:"/api/add/relationship",headers:{"Content-Type":"application/json"},data:JSON.stringify(r)}).then((e=>{t(e)})).catch((e=>{n(e.response)}))})),p=(e,a)=>new Promise(((t,n)=>{(0,o.A)({method:"delete",url:"/api/update/relationship",headers:{"Content-Type":"application/json"},params:{evaluatorId:e,userId:a}}).then((e=>{t(e)})).catch((e=>{n(e.response)}))})),m=e=>new Promise(((a,t)=>{let n=new FormData;n.append("file",e),(0,o.A)({method:"post",url:"/api/import/relationship",headers:{"Content-Type":"multipart/form-data"},data:n}).then((e=>{a(e)})).catch((e=>{t(e.response)}))})),h=()=>new Promise(((e,a)=>{(0,o.A)({method:"get",url:"/api/relation/step",headers:{"Content-Type":"application/json"}}).then((a=>{e(a)})).catch((e=>{a(e.response)}))})),g=()=>new Promise(((e,a)=>{(0,o.A)({method:"get",url:"/api/export/relationship",headers:{"Content-Type":"application/json"},responseType:"blob"}).then((a=>{e(a)})).catch((e=>{a(e.response)}))}));var y=t(41),v=t(543),f=t(9314);const k={class:"score-matrix"},w={class:"content-header"},x={class:"search-form"},b={class:"submit-Btn"},A={class:"content-table"},N={class:"actionBtn"};var I={__name:"ScoringMatrix",setup(e){const a=(0,l.KR)(!1),t=(0,l.KR)(),o=()=>{(0,v.Q)().then((e=>{if(200===e.data.code)for(let n=0;n<=e.data.data.evaluateStep.length-1;n++)1===e.data.data.evaluateStep[n].enable&&(t.value=n+1+"","1"===t.value?a.value=!1:a.value=!0);else i.Ay.error("获取失败！"+e.data.msg)})).catch((e=>{console.log("获取失败！",e)}))},I=(0,l.Kh)({name:null}),C=(0,l.KR)(null),_=()=>{K.current=1,T()},K=(0,l.Kh)({pageSize:12,current:1,showSizeChanger:!1,total:0,showTotal:(e,a)=>`总共 ${e} 条数据`}),S=(0,l.KR)([{title:"序号",dataIndex:"index",key:"index",fixed:"left",align:"center",width:65},{title:"被评估人",dataIndex:"name",key:"name",fixed:"left",align:"center",width:120},{title:"部门",dataIndex:"department",key:"department",align:"center",width:100},{title:"LXYZ类型",dataIndex:"lxyz",key:"lxyz",align:"center",width:100},{title:"业务类型",dataIndex:"businessType",key:"businessType",align:"center",width:90},{title:"主管1",dataIndex:"supervisorName1",key:"supervisorName1",align:"center",width:100},{title:"权重1",dataIndex:"weight1",key:"weight1",align:"center",width:75},{title:"主管2",dataIndex:"supervisorName2",key:"supervisorName2",align:"center",width:100},{title:"权重2",dataIndex:"weight2",key:"weight2",align:"center",width:75},{title:"主管3",dataIndex:"supervisorName3",key:"supervisorName3",align:"center",width:100},{title:"权重3",dataIndex:"weight3",key:"weight3",align:"center",width:75},{title:"HRBP",dataIndex:"hrName",key:"hrName",align:"center",width:100},{title:"相关人",dataIndex:"relatedPerson",key:"relatedPerson",align:"center",width:400},{title:"超级管理员",dataIndex:"superAdminName",key:"superAdminName",align:"center",width:120},{title:"一级管理员",dataIndex:"firstAdminName",key:"firstAdminName",align:"center",width:120},{title:"二级管理员",dataIndex:"secondAdminName",key:"secondAdminName",align:"center",width:120},{title:"操作",key:"action",fixed:"right",align:"center",width:160}]),F=(0,l.KR)([]),P=(0,l.KR)("60vh"),R=()=>{const e=window.innerHeight,a=e-50-10;P.value=e<800?.62*a+"px":.7*a+"px"},T=()=>{s(K.current,K.pageSize,I.name).then((e=>{if(200===e.data.code){K.total=e.data.data.total,F.value=[];for(let a=0;a<e.data.data.data.length;a++)F.value.push({index:K.current*K.pageSize-K.pageSize+a+1,userId:e.data.data.data[a].userId,name:e.data.data.data[a].name,supervisorName1:e.data.data.data[a].supervisorName1,supervisorName2:e.data.data.data[a].supervisorName2,supervisorName3:e.data.data.data[a].supervisorName3,weight1:e.data.data.data[a].weight1,weight2:e.data.data.data[a].weight2,weight3:e.data.data.data[a].weight3,department:e.data.data.data[a].department,lxyz:e.data.data.data[a].lxyz,businessType:e.data.data.data[a].business,firstAdminName:e.data.data.data[a].firstAdminName,secondAdminName:e.data.data.data[a].secondAdminName,superAdminName:e.data.data.data[a].superAdminName,hrName:e.data.data.data[a].hrName,relatedPerson:e.data.data.data[a].relatedPerson})}})).catch((e=>{i.Ay.error("请求失败！"+e)}))},z=e=>{K.current=Number(e.current),K.pageSize=e.pageSize,T()},j=(0,l.KR)(!1),L=(0,l.KR)([{title:"序号",dataIndex:"index",key:"index",width:"15%",align:"center"},{title:"用户名",dataIndex:"username",key:"username",align:"center"},{title:"工号",dataIndex:"jobuNumber",key:"jobuNumber",align:"center"},{title:"部门",dataIndex:"department",key:"department",align:"center"},{title:"操作",key:"action",width:"15%",align:"center"}]),W=(0,l.KR)([]),X=e=>{C.value=e.userId,W.value=[],u(e.userId).then((e=>{if(200===e.data.code)for(let a=0;a<e.data.data.length;a++)W.value.push({index:a+1,key:e.data.data[a].userId,username:e.data.data[a].name,jobuNumber:e.data.data[a].workNum,department:e.data.data[a].department});else i.Ay.error("获取失败！"+e.data.msg)})).catch((e=>{console.log("请求失败！",e)})),j.value=!0},O=e=>{const a=W.value.findIndex((a=>a.key===e.key));p(e.key,C.value).then((e=>{200===e.data.code?(i.Ay.success("删除成功！"),-1!==a&&W.value.splice(a,1),T()):i.Ay.error("删除失败！"+e.data.msg)})).catch((e=>{i.Ay.error("请求失败！"+e)}))},U=(0,l.KR)(!1),$=()=>{E(),U.value=!0},B=(0,l.KR)([]),D=(0,l.KR)([]),E=()=>{(0,y._8)().then((e=>{if(200===e.data.code){D.value=[{label:"空值",value:0}];for(let a=0;a<=e.data.data.length-1;a++)D.value.push({label:e.data.data[a].name+"("+e.data.data[a].department+")",value:e.data.data[a].userId,name:e.data.data[a].name})}else i.Ay.error("获取失败！"+e.data.msg)})).catch((e=>{i.Ay.error("请求失败！"+e)}))},Q=()=>{const e=Object.values(B.value);0!==e.length?c(e,C.value).then((e=>{200===e.data.code?(i.Ay.success("添加固定评估人成功！^_^"),B.value=[],T(),U.value=!1,j.value=!1):i.Ay.error(e.data.msg)})).catch((e=>{console.log("请求失败！",e)})):i.Ay.error("请选择评估人！")},J=(0,l.KR)(null),H=(0,l.KR)(!1),M=()=>{J.value.click()},V=e=>{const a=e.target.files[0];a&&(H.value=!0,m(a).then((a=>{H.value=!1,200===a.data.code?(i.Ay.success("文件上传成功~ =• ֊ •="),setTimeout((()=>{location.reload()}),500)):(Y("warn",a.data.msg||"文件上传失败，未知原因"),T(),e.target.value="")})).catch((a=>{H.value=!1,console.log("请求失败！",a),e.target.value=""})))},Y=(e,a)=>{f.A[e]({message:"矩阵关系导入情况",description:a,duration:null})},q=()=>{const e=new Date,a=e.getFullYear(),t=(e.getMonth()+1).toString().padStart(2,"0"),n=e.getDate().toString().padStart(2,"0");return`${a}-${t}-${n}`},Z=()=>{g().then((e=>{if(e&&e.data){const a=new Blob([e.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),t=document.createElement("a"),n=URL.createObjectURL(a),r=`矩阵关系导出表格${q()}.xlsx`;t.href=n,t.download=r,t.click(),i.Ay.success("矩阵关系导出成功！")}else i.Ay.error("导出失败！未知错误")})).catch((e=>{console.error("请求失败：",e),i.Ay.error("请求失败！")}))},G=()=>{H.value=!0,h().then((e=>{200===e.data.code?(i.Ay.success("您已发布本轮评估矩阵关系!"),a.value=!0,H.value=!1):(i.Ay.error("发布失败！"+e.data.msg),H.value=!1)})).catch((e=>{i.Ay.error("请求失败！"+e),H.value=!1}))},ee=(e,a)=>!e||a.label.toLowerCase().includes(e.toLowerCase());return(0,n.sV)((()=>{T(),o(),R(),window.addEventListener("resize",R)})),(0,n.hi)((()=>{window.removeEventListener("resize",R)})),(e,t)=>{const l=(0,n.g2)("a-input"),i=(0,n.g2)("a-form-item"),o=(0,n.g2)("a-button"),s=(0,n.g2)("a-form"),u=(0,n.g2)("a-popconfirm"),c=(0,n.g2)("a-spin"),p=(0,n.g2)("a-table"),m=(0,n.g2)("a-modal"),h=(0,n.g2)("a-select");return(0,n.uX)(),(0,n.CE)("div",k,[(0,n.Lk)("div",w,[(0,n.Lk)("div",x,[(0,n.bF)(s,{style:{display:"flex","align-items":"center"}},{default:(0,n.k6)((()=>[(0,n.bF)(i,{style:{"margin-right":"10px",width:"300px"}},{default:(0,n.k6)((()=>[(0,n.bF)(l,{placeholder:"请输入被评估人姓名",value:I.name,"onUpdate:value":t[0]||(t[0]=e=>I.name=e),allowClear:!0},null,8,["value"])])),_:1}),(0,n.bF)(i,null,{default:(0,n.k6)((()=>[(0,n.bF)(o,{type:"primary",onClick:(0,r.D$)(_,["prevent"]),class:"seachBtn"},{default:(0,n.k6)((()=>t[5]||(t[5]=[(0,n.eW)("搜索")]))),_:1})])),_:1})])),_:1})]),(0,n.Lk)("div",b,[(0,n.bF)(o,{type:"primary",style:{"margin-right":"10px"},onClick:M},{default:(0,n.k6)((()=>t[6]||(t[6]=[(0,n.eW)("导入数据")]))),_:1}),(0,n.bF)(o,{type:"primary",style:{"margin-right":"10px"},onClick:Z},{default:(0,n.k6)((()=>t[7]||(t[7]=[(0,n.eW)("导出模板")]))),_:1}),(0,n.bF)(u,{placement:"bottom",title:"确定要发布本轮矩阵关系吗？","ok-text":"确定","cancel-text":"取消",onConfirm:t[1]||(t[1]=e=>G())},{default:(0,n.k6)((()=>[a.value?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.Wv)(o,{key:0,type:"primary",style:{"background-color":"#39ba06"}},{default:(0,n.k6)((()=>t[8]||(t[8]=[(0,n.eW)(" 发布 ")]))),_:1}))])),_:1}),a.value?((0,n.uX)(),(0,n.Wv)(o,{key:0,type:"primary",disabled:""},{default:(0,n.k6)((()=>t[9]||(t[9]=[(0,n.eW)(" 已发布 ")]))),_:1})):(0,n.Q3)("",!0),(0,n.Lk)("input",{ref_key:"fileInput",ref:J,type:"file",accept:".xls,.xlsx",style:{display:"none"},onChange:V},null,544),(0,n.bF)(c,{spinning:H.value,class:"loading-spin",size:"large"},null,8,["spinning"])])]),(0,n.Lk)("div",A,[(0,n.bF)(p,{columns:S.value,"data-source":F.value,rowKey:e=>e.key,scroll:{y:P.value},pagination:K,bordered:!0,onChange:z},{bodyCell:(0,n.k6)((({text:e,record:a,column:r})=>["action"===r.key?((0,n.uX)(),(0,n.Wv)(o,{key:0,type:"text",onClick:e=>X(a),style:{color:"#0014b7"}},{default:(0,n.k6)((()=>t[10]||(t[10]=[(0,n.eW)("修改固定评估人")]))),_:2},1032,["onClick"])):((0,n.uX)(),(0,n.CE)(n.FK,{key:1},[(0,n.eW)((0,d.v_)(e),1)],64))])),_:1},8,["columns","data-source","rowKey","scroll","pagination"]),(0,n.bF)(m,{open:j.value,"onUpdate:open":t[2]||(t[2]=e=>j.value=e),title:"修改固定评估人",footer:null},{default:(0,n.k6)((()=>[(0,n.bF)(p,{columns:L.value,"data-source":W.value,bordered:!0,pagination:!1,scroll:{y:"60vh"}},{bodyCell:(0,n.k6)((({column:e,record:a})=>["action"===e.key?((0,n.uX)(),(0,n.Wv)(u,{key:0,title:"确定要移除吗？","ok-text":"确定","cancel-text":"取消",onConfirm:e=>O(a)},{default:(0,n.k6)((()=>t[11]||(t[11]=[(0,n.Lk)("a",{style:{color:"#bd3124","font-weight":"bold"}}," 移除 ",-1)]))),_:2},1032,["onConfirm"])):(0,n.Q3)("",!0)])),_:1},8,["columns","data-source"]),(0,n.Lk)("div",N,[(0,n.bF)(o,{type:"primary",onClick:$},{default:(0,n.k6)((()=>t[12]||(t[12]=[(0,n.eW)("添加评估人")]))),_:1})])])),_:1},8,["open"]),(0,n.bF)(m,{open:U.value,"onUpdate:open":t[4]||(t[4]=e=>U.value=e),title:"添加评估人",onOk:Q},{default:(0,n.k6)((()=>[(0,n.bF)(h,{value:B.value,"onUpdate:value":t[3]||(t[3]=e=>B.value=e),options:D.value,mode:"multiple",placeholder:"请选择",style:{width:"100%"},"filter-option":ee},null,8,["value","options"])])),_:1},8,["open"])])])}}},C=t(3578);const _=(0,C.A)(I,[["__scopeId","data-v-67d4f56d"]]);var K=_}}]);
//# sourceMappingURL=238.653d7de2.js.map