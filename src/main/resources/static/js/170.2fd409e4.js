"use strict";(self["webpackChunkscoring_system_front"]=self["webpackChunkscoring_system_front"]||[]).push([[170],{41:function(e,a,t){t.d(a,{AV:function(){return i},XD:function(){return r},_8:function(){return d},q6:function(){return l}});var n=t(5857);const r=(e,a)=>new Promise(((t,r)=>{(0,n.A)({method:"get",url:"/api/todolist",headers:{"Content-Type":"application/json"},params:{pageNum:e,pageSize:a}}).then((e=>{t(e)})).catch((e=>{r(e.response)}))})),d=()=>new Promise(((e,a)=>{(0,n.A)({method:"get",url:"/api/findAll",headers:{"Content-Type":"application/json"}}).then((a=>{e(a)})).catch((e=>{a(e.response)}))})),l=e=>new Promise(((a,t)=>{let r={userIds:e};(0,n.A)({method:"post",url:"/api/add/evaluated",headers:{"Content-Type":"application/json"},data:JSON.stringify(r)}).then((e=>{a(e)})).catch((e=>{t(e.response)}))})),i=()=>new Promise(((e,a)=>{(0,n.A)({method:"get",url:"/api/find/assessor",headers:{"Content-Type":"application/json"}}).then((a=>{e(a)})).catch((e=>{a(e.response)}))}))},170:function(e,a,t){t.r(a),t.d(a,{default:function(){return R}});t(9138),t(1531),t(3678),t(4145);var n=t(7616),r=t(5523),d=t(5929),l=t(3e3),i=t(1516),o=(t(3369),t(5857));const s=(e,a,t)=>new Promise(((n,r)=>{let d={name:t,pageNum:e,pageSize:a};(0,o.A)({method:"post",url:"/api/find/relationships",headers:{"Content-Type":"application/json"},data:JSON.stringify(d)}).then((e=>{n(e)})).catch((e=>{r(e.response)}))})),u=e=>new Promise(((a,t)=>{(0,o.A)({method:"get",url:"/api/matrix/relatedPersonInfo",headers:{"Content-Type":"application/json"},params:{userId:e}}).then((e=>{a(e)})).catch((e=>{t(e.response)}))})),c=(e,a)=>new Promise(((t,n)=>{let r={evaluatorIds:e,userId:a};(0,o.A)({method:"post",url:"/api/add/relationship",headers:{"Content-Type":"application/json"},data:JSON.stringify(r)}).then((e=>{t(e)})).catch((e=>{n(e.response)}))})),p=(e,a)=>new Promise(((t,n)=>{(0,o.A)({method:"delete",url:"/api/update/relationship",headers:{"Content-Type":"application/json"},params:{evaluatorId:e,userId:a}}).then((e=>{t(e)})).catch((e=>{n(e.response)}))})),m=e=>new Promise(((a,t)=>{let n=new FormData;n.append("file",e),(0,o.A)({method:"post",url:"/api/import/relationship",headers:{"Content-Type":"multipart/form-data"},data:n}).then((e=>{a(e)})).catch((e=>{t(e.response)}))})),h=()=>new Promise(((e,a)=>{(0,o.A)({method:"get",url:"/api/relation/step",headers:{"Content-Type":"application/json"}}).then((a=>{e(a)})).catch((e=>{a(e.response)}))})),g=()=>new Promise(((e,a)=>{(0,o.A)({method:"get",url:"/api/export/relationship",headers:{"Content-Type":"application/json"},responseType:"blob"}).then((a=>{e(a)})).catch((e=>{a(e.response)}))}));var y=t(41),v=t(543),k=t(9314);const f={key:0,class:"score-matrix"},w={class:"content-header"},x={class:"search-form"},b={class:"submit-Btn"},A={class:"content-table"},N={class:"actionBtn"},I={key:1,class:"no-permission"};var C={__name:"ScoringMatrix",setup(e){const a=(0,l.KR)(localStorage.getItem("userRole")),t=(0,l.KR)(!1);"3"!==a.value&&"2"!==a.value||(t.value=!0);const o=(0,l.KR)(!1),C=(0,l.KR)(),_=()=>{(0,v.Q)().then((e=>{if(200===e.data.code)for(let a=0;a<=e.data.data.evaluateStep.length-1;a++)1===e.data.data.evaluateStep[a].enable&&(C.value=a+1+"","1"===C.value?o.value=!1:o.value=!0);else i.Ay.error("获取失败！"+e.data.msg)})).catch((e=>{console.log("获取失败！",e)}))},K=(0,l.Kh)({name:null}),R=(0,l.KR)(null),S=()=>{F.current=1,L()},F=(0,l.Kh)({pageSize:12,current:1,showSizeChanger:!1,total:0,showTotal:(e,a)=>`总共 ${e} 条数据`}),P=(0,l.KR)([{title:"序号",dataIndex:"index",key:"index",fixed:"left",align:"center",width:65},{title:"被评估人*",dataIndex:"name",key:"name",fixed:"left",align:"center",width:120},{title:"部门",dataIndex:"department",key:"department",align:"center",width:100},{title:"LXYZ类型",dataIndex:"lxyz",key:"lxyz",align:"center",width:100},{title:"业务类型",dataIndex:"businessType",key:"businessType",align:"center",width:90},{title:"主管1*",dataIndex:"supervisorName1",key:"supervisorName1",align:"center",width:100},{title:"权重1*",dataIndex:"weight1",key:"weight1",align:"center",width:75},{title:"主管2*",dataIndex:"supervisorName2",key:"supervisorName2",align:"center",width:100},{title:"权重2*",dataIndex:"weight2",key:"weight2",align:"center",width:75},{title:"主管3*",dataIndex:"supervisorName3",key:"supervisorName3",align:"center",width:100},{title:"权重3*",dataIndex:"weight3",key:"weight3",align:"center",width:75},{title:"HRBP",dataIndex:"hrName",key:"hrName",align:"center",width:100},{title:"相关人*",dataIndex:"relatedPerson",key:"relatedPerson",align:"center",width:400},{title:"超级管理员",dataIndex:"superAdminName",key:"superAdminName",align:"center",width:120},{title:"一级管理员",dataIndex:"firstAdminName",key:"firstAdminName",align:"center",width:120},{title:"二级管理员",dataIndex:"secondAdminName",key:"secondAdminName",align:"center",width:120},{title:"操作",key:"action",fixed:"right",align:"center",width:160}]),T=(0,l.KR)([]),z=(0,l.KR)("60vh"),j=()=>{const e=window.innerHeight,a=e-50-10;z.value=e<700?.6*a+"px":e<800?.62*a+"px":.7*a+"px"},L=()=>{s(F.current,F.pageSize,K.name).then((e=>{if(200===e.data.code){F.total=e.data.data.total,T.value=[];for(let a=0;a<e.data.data.data.length;a++)T.value.push({index:F.current*F.pageSize-F.pageSize+a+1,userId:e.data.data.data[a].userId,name:e.data.data.data[a].name,supervisorName1:e.data.data.data[a].supervisorName1,supervisorName2:e.data.data.data[a].supervisorName2,supervisorName3:e.data.data.data[a].supervisorName3,weight1:e.data.data.data[a].weight1,weight2:e.data.data.data[a].weight2,weight3:e.data.data.data[a].weight3,department:e.data.data.data[a].department,lxyz:e.data.data.data[a].lxyz,businessType:e.data.data.data[a].business,firstAdminName:e.data.data.data[a].firstAdminName,secondAdminName:e.data.data.data[a].secondAdminName,superAdminName:e.data.data.data[a].superAdminName,hrName:e.data.data.data[a].hrName,relatedPerson:e.data.data.data[a].relatedPerson})}})).catch((e=>{i.Ay.error("请求失败！"+e)}))},W=e=>{F.current=Number(e.current),F.pageSize=e.pageSize,L()},X=(0,l.KR)(!1),E=(0,l.KR)([{title:"序号",dataIndex:"index",key:"index",width:"15%",align:"center"},{title:"用户名",dataIndex:"username",key:"username",align:"center"},{title:"工号",dataIndex:"jobuNumber",key:"jobuNumber",align:"center"},{title:"部门",dataIndex:"department",key:"department",align:"center"},{title:"操作",key:"action",width:"15%",align:"center"}]),O=(0,l.KR)([]),U=e=>{R.value=e.userId,O.value=[],u(e.userId).then((e=>{if(200===e.data.code)for(let a=0;a<e.data.data.length;a++)O.value.push({index:a+1,key:e.data.data[a].userId,username:e.data.data[a].name,jobuNumber:e.data.data[a].workNum,department:e.data.data[a].department});else i.Ay.error("获取失败！"+e.data.msg)})).catch((e=>{console.log("请求失败！",e)})),X.value=!0},$=e=>{const a=O.value.findIndex((a=>a.key===e.key));p(e.key,R.value).then((e=>{200===e.data.code?(i.Ay.success("删除成功！"),-1!==a&&O.value.splice(a,1),L()):i.Ay.error("删除失败！"+e.data.msg)})).catch((e=>{i.Ay.error("请求失败！"+e)}))},B=(0,l.KR)(!1),D=()=>{H(),B.value=!0},Q=(0,l.KR)([]),J=(0,l.KR)([]),H=()=>{(0,y._8)().then((e=>{if(200===e.data.code){J.value=[{label:"空值",value:0}];for(let a=0;a<=e.data.data.length-1;a++)J.value.push({label:e.data.data[a].name+"("+e.data.data[a].department+")",value:e.data.data[a].userId,name:e.data.data[a].name})}else i.Ay.error("获取失败！"+e.data.msg)})).catch((e=>{i.Ay.error("请求失败！"+e)}))},M=(0,l.KR)(!1),V=()=>{if(M.value)return void i.Ay.warning("正在提交中，请勿重复提交！");M.value=!0;const e=Object.values(Q.value);0!==e.length?c(e,R.value).then((e=>{200===e.data.code?(i.Ay.success("添加固定评估人成功！^_^"),Q.value=[],L(),B.value=!1,X.value=!1):i.Ay.error(e.data.msg)})).catch((e=>{console.log("请求失败！",e)})).finally((()=>{M.value=!1})):i.Ay.error("请选择评估人！")},Y=(0,l.KR)(null),q=(0,l.KR)(!1),Z=()=>{Y.value.click()},G=e=>{const a=e.target.files[0];a&&(q.value=!0,m(a).then((a=>{q.value=!1,200===a.data.code?(i.Ay.success("文件上传成功~ =• ֊ •="),setTimeout((()=>{location.reload()}),500)):(ee("warn",a.data.msg||"文件上传失败，未知原因"),L(),e.target.value="")})).catch((a=>{q.value=!1,console.log("请求失败！",a),e.target.value=""})))},ee=(e,a)=>{k.A[e]({message:"矩阵关系导入情况",description:a,duration:null})},ae=()=>{const e=new Date,a=e.getFullYear(),t=(e.getMonth()+1).toString().padStart(2,"0"),n=e.getDate().toString().padStart(2,"0");return`${a}-${t}-${n}`},te=()=>{g().then((e=>{if(e&&e.data){const a=new Blob([e.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),t=document.createElement("a"),n=URL.createObjectURL(a),r=`矩阵关系导出表格${ae()}.xlsx`;t.href=n,t.download=r,t.click(),i.Ay.success("矩阵关系导出成功！")}else i.Ay.error("导出失败！未知错误")})).catch((e=>{console.error("请求失败：",e),i.Ay.error("请求失败！")}))},ne=()=>{q.value=!0,h().then((e=>{200===e.data.code?(i.Ay.success("您已发布本轮评估矩阵关系!"),o.value=!0,q.value=!1):(i.Ay.error("发布失败！"+e.data.msg),q.value=!1)})).catch((e=>{i.Ay.error("请求失败！"+e),q.value=!1}))},re=(e,a)=>!e||a.label.toLowerCase().includes(e.toLowerCase());return(0,n.sV)((()=>{L(),_(),j(),window.addEventListener("resize",j)})),(0,n.hi)((()=>{window.removeEventListener("resize",j)})),(e,a)=>{const l=(0,n.g2)("a-input"),i=(0,n.g2)("a-form-item"),s=(0,n.g2)("a-button"),u=(0,n.g2)("a-form"),c=(0,n.g2)("a-popconfirm"),p=(0,n.g2)("a-spin"),m=(0,n.g2)("a-table"),h=(0,n.g2)("a-modal"),g=(0,n.g2)("a-select"),y=(0,n.g2)("a-empty");return t.value?((0,n.uX)(),(0,n.CE)("div",f,[(0,n.Lk)("div",w,[(0,n.Lk)("div",x,[(0,n.bF)(u,{style:{display:"flex","align-items":"center"}},{default:(0,n.k6)((()=>[(0,n.bF)(i,{style:{"margin-right":"10px",width:"300px"}},{default:(0,n.k6)((()=>[(0,n.bF)(l,{placeholder:"请输入被评估人姓名",value:K.name,"onUpdate:value":a[0]||(a[0]=e=>K.name=e),allowClear:!0},null,8,["value"])])),_:1}),(0,n.bF)(i,null,{default:(0,n.k6)((()=>[(0,n.bF)(s,{type:"primary",onClick:(0,r.D$)(S,["prevent"]),class:"seachBtn"},{default:(0,n.k6)((()=>a[5]||(a[5]=[(0,n.eW)("搜索")]))),_:1})])),_:1})])),_:1})]),(0,n.Lk)("div",b,[(0,n.bF)(s,{type:"primary",style:{"margin-right":"10px"},onClick:Z},{default:(0,n.k6)((()=>a[6]||(a[6]=[(0,n.eW)("导入数据")]))),_:1}),(0,n.bF)(s,{type:"primary",style:{"margin-right":"10px"},onClick:te},{default:(0,n.k6)((()=>a[7]||(a[7]=[(0,n.eW)("导出模板")]))),_:1}),(0,n.bF)(c,{placement:"bottom",title:"确定要发布本轮矩阵关系吗？","ok-text":"确定","cancel-text":"取消",onConfirm:a[1]||(a[1]=e=>ne())},{default:(0,n.k6)((()=>[o.value?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.Wv)(s,{key:0,type:"primary",style:{"background-color":"#39ba06"}},{default:(0,n.k6)((()=>a[8]||(a[8]=[(0,n.eW)(" 发布 ")]))),_:1}))])),_:1}),o.value?((0,n.uX)(),(0,n.Wv)(s,{key:0,type:"primary",disabled:""},{default:(0,n.k6)((()=>a[9]||(a[9]=[(0,n.eW)(" 已发布 ")]))),_:1})):(0,n.Q3)("",!0),(0,n.Lk)("input",{ref_key:"fileInput",ref:Y,type:"file",accept:".xls,.xlsx",style:{display:"none"},onChange:G},null,544),(0,n.bF)(p,{spinning:q.value,class:"loading-spin",size:"large"},null,8,["spinning"])])]),(0,n.Lk)("div",A,[(0,n.bF)(m,{columns:P.value,"data-source":T.value,rowKey:e=>e.key,scroll:{y:z.value},pagination:F,bordered:!0,onChange:W},{bodyCell:(0,n.k6)((({text:e,record:t,column:r})=>["action"===r.key?((0,n.uX)(),(0,n.Wv)(s,{key:0,type:"text",onClick:e=>U(t),style:{color:"#0014b7"}},{default:(0,n.k6)((()=>a[10]||(a[10]=[(0,n.eW)("修改固定评估人")]))),_:2},1032,["onClick"])):((0,n.uX)(),(0,n.CE)(n.FK,{key:1},[(0,n.eW)((0,d.v_)(e),1)],64))])),_:1},8,["columns","data-source","rowKey","scroll","pagination"]),(0,n.bF)(h,{open:X.value,"onUpdate:open":a[2]||(a[2]=e=>X.value=e),title:"修改固定评估人",footer:null},{default:(0,n.k6)((()=>[(0,n.bF)(m,{columns:E.value,"data-source":O.value,bordered:!0,pagination:!1,scroll:{y:"60vh"}},{bodyCell:(0,n.k6)((({column:e,record:t})=>["action"===e.key?((0,n.uX)(),(0,n.Wv)(c,{key:0,title:"确定要移除吗？","ok-text":"确定","cancel-text":"取消",onConfirm:e=>$(t)},{default:(0,n.k6)((()=>a[11]||(a[11]=[(0,n.Lk)("a",{style:{color:"#bd3124","font-weight":"bold"}}," 移除 ",-1)]))),_:2},1032,["onConfirm"])):(0,n.Q3)("",!0)])),_:1},8,["columns","data-source"]),(0,n.Lk)("div",N,[(0,n.bF)(s,{type:"primary",onClick:D},{default:(0,n.k6)((()=>a[12]||(a[12]=[(0,n.eW)("添加评估人")]))),_:1})])])),_:1},8,["open"]),(0,n.bF)(h,{open:B.value,"onUpdate:open":a[4]||(a[4]=e=>B.value=e),title:"添加评估人",onOk:V},{default:(0,n.k6)((()=>[(0,n.bF)(g,{value:Q.value,"onUpdate:value":a[3]||(a[3]=e=>Q.value=e),options:J.value,mode:"multiple",placeholder:"请选择",style:{width:"100%"},"filter-option":re},null,8,["value","options"])])),_:1},8,["open"])])])):((0,n.uX)(),(0,n.CE)("div",I,[(0,n.bF)(y,{description:"您暂无权限查看该页面0~0"})]))}}},_=t(3578);const K=(0,_.A)(C,[["__scopeId","data-v-7163ab12"]]);var R=K}}]);
//# sourceMappingURL=170.2fd409e4.js.map