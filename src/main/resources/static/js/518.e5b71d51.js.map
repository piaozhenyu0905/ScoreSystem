{"version":3,"file":"js/518.e5b71d51.js","mappings":"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","sources":["webpack://scoring_system_front/./src/api/todoList.js","webpack://scoring_system_front/./src/page/ordinary/TodoList.vue","webpack://scoring_system_front/./src/page/ordinary/TodoList.vue?bdb3"],"sourcesContent":["import axios from \"axios\";\n\n//获取该时间段内的执行情况数据\nconst getTodoListApi = (pageNum, pageSize) => new Promise((resolve, reject) =>{\n    axios({\n        method:'get',\n        url:'/api/todolist',\n        headers:{\n            \"Content-Type\": \"application/json\",\n        },\n        params: {\n            pageNum: pageNum,\n            pageSize: pageSize\n        },\n    }).then((response)=>{\n        resolve(response)\n    }).catch((error)=>{\n        reject(error.response)\n    })\n})\n\n//获取人员列表\nconst getUserListApi = () => new Promise((resolve, reject) =>{\n    axios({\n        method:'get',\n        url:'/api/findAll',\n        headers:{\n            \"Content-Type\": \"application/json\",\n        }\n    }).then((response)=>{\n        resolve(response)\n    }).catch((error)=>{\n        reject(error.response)\n    })\n})\n\n//提交选择的被评估人\nconst getEvaluatedListApi = (userIds) => new Promise((resolve, reject) =>{\n    let data = {\n        userIds: userIds\n    };\n    axios({\n        method:'post',\n        url:'/api/add/evaluated',\n        headers:{\n            \"Content-Type\": \"application/json\",\n        },\n      data: JSON.stringify(data),\n    }).then((response)=>{\n        resolve(response)\n    }).catch((error)=>{\n        reject(error.response)\n    })\n})\n\n// 获取当前需要打分的人（即我是谁的自主评估人）\nconst getAssessorApi = () => new Promise((resolve, reject) =>{\n    axios({\n        method:'get',\n        url:'/api/find/assessor',\n        headers:{\n            \"Content-Type\": \"application/json\",\n        }\n    }).then((response)=>{\n        resolve(response)\n    }).catch((error)=>{\n        reject(error.response)\n    })\n})\n\n// 导出我的打分数据\nconst getExportSelfDataApi = () => new Promise((resolve, reject) =>{\n    axios({ \n        method:'get',\n        url:'/api/export/tick',\n        headers:{\n            \"Content-Type\": \"application/json\",\n        },\n        responseType: 'blob'  // 设置响应类型为 blob，表示二进制文件\n    }).then((response)=>{\n        resolve(response)\n    }).catch((error)=>{\n        reject(error.response)\n    })\n})\n\n// 导出待评分列表\nconst getExportEvaluatedInfoApi = () => new Promise((resolve, reject) =>{\n    axios({ \n        method:'get',\n        url:'/api/export/evaluatedInfo',\n        headers:{\n            \"Content-Type\": \"application/json\",\n        },\n        responseType: 'blob'  // 设置响应类型为 blob，表示二进制文件\n    }).then((response)=>{\n        resolve(response)\n    }).catch((error)=>{\n        reject(error.response)\n    })\n})\n\nexport{\n    getTodoListApi,\n    getUserListApi,\n    getEvaluatedListApi,\n    getAssessorApi,\n    getExportSelfDataApi,\n    getExportEvaluatedInfoApi\n}","<!-- 普通用户--我的待办 -->\n<script setup>\nimport { ref, reactive, onMounted, onUnmounted } from \"vue\";\n// import { FormOutlined } from '@ant-design/icons-vue';\nimport { message } from \"ant-design-vue\";\nimport { useRouter } from \"vue-router\";\nimport {\n  getTodoListApi,\n  getUserListApi,\n  getEvaluatedListApi,\n  getAssessorApi,\n  getExportSelfDataApi,\n  getExportEvaluatedInfoApi\n} from \"@/api/todoList\";\nimport { getStepTimeApi } from \"@/api/scoreTimeSet\"\nimport { notification } from \"ant-design-vue\";\n\nonMounted(() => {\n  getTodoList();\n  getUserList();\n  updateScrollHeight();\n  getStepTime();\n  window.addEventListener(\"resize\", updateScrollHeight);\n\n  getAssessor();\n}); \n\n// 获取当前评估进度\nconst isVisible = ref(false)\nconst currentSession = ref()\nconst getStepTime = () => {\n  getStepTimeApi()\n    .then(res => {\n      if (res.data.code === 200) {\n        for (let i = 0; i <= res.data.data.evaluateStep.length - 1; i++) {\n          if (res.data.data.evaluateStep[i].enable === 1) {\n            currentSession.value = i + 1 + '';\n            if (currentSession.value === '1') {\n              isVisible.value = true\n            }\n          }\n        }\n      } else {\n        message.error('获取失败！' + res.data.msg)\n      }\n    })\n    .catch(err => {\n      console.log('获取失败！', err);\n    });\n};\n\n// 进入页面提示可添加“我要评估”\nconst openNotificationWithIcon = (type, message) => {\n  notification[type]({\n    message: \"小提示\",\n    description: message,\n    duration: 300, // 设置持续时间为 null，表示通知不自动关闭\n    placement: \"top\", // 设置位置为顶部居中\n    style: {\n      fontSize: \"18px\", // 直接修改字体大小\n    },\n  });\n};\n\n// 在组件卸载时移除事件监听\nonUnmounted(() => {\n  window.removeEventListener(\"resize\", updateScrollHeight);\n});\n\nconst scrollHeight = ref(\"60vh\"); // 定义滚动区域高度\nconst router = useRouter();\nconst pagination = reactive({\n  // 表格页码相关设置\n  pageSize: 12, //每页最多条目数\n  current: 1, //当前页码\n  showSizeChanger: false,\n  total: 0, //总条目数\n  showTotal: (total, range) => `总共 ${total} 条数据`, // 在这里定义显示总数据量的格式\n});\nconst columns = ref([\n  {\n    title: \"序号\",\n    dataIndex: \"index\",\n    key: \"index\",\n    width: \"10%\",\n    align: \"center\",\n  },\n  {\n    title: \"任务类型\",\n    dataIndex: \"taskTag\",\n    key: \"taskTag\",\n    width: \"15%\",\n    align: \"center\",\n  },\n  {\n    title: \"任务详情\",\n    dataIndex: \"taskDetail\",\n    key: \"taskDetail\",\n    width: \"30%\",\n    align: \"center\",\n  },\n  {\n    title: \"提交时间\",\n    dataIndex: \"submitTime\",\n    key: \"submitTime\",\n    align: \"center\",\n  },\n  {\n    title: \"操作\",\n    key: \"action\",\n    align: \"center\",\n  },\n]);\nconst data = ref([]);\n\n// 动态更新高度\nconst updateScrollHeight = () => {\n  const screenHeight = window.innerHeight;\n  const containerHeight = screenHeight - 35 - 10; // 假设父容器需要减去固定的偏移量\n  if (screenHeight < 800) {\n    scrollHeight.value = `${containerHeight * 0.63}px`; // 小屏幕高度为 50%\n  } else {\n    scrollHeight.value = `${containerHeight * 0.7}px`; // 大屏幕高度为 80%\n  }\n};\n// 待办完成进度相关配置\nconst notDone = ref()\n// 调用api-获取待办列表\nconst getTodoList = () => {\n  // 清空 data.value\n  data.value.splice(0, data.value.length);\n  // 处理当前页码\n  if (sessionStorage.getItem(\"currentIndex\")) {\n    pagination.current = sessionStorage.getItem(\"currentIndex\");\n  }\n  getTodoListApi(pagination.current, pagination.pageSize)\n    .then((res) => {\n      if (res.data.code === 200) {\n        // 设置分页总数\n        pagination.total = res.data.data.total;\n        notDone.value = res.data.data.total;\n\n        // 清空 data.value，避免多次追加导致重复数据\n        data.value = [];\n\n        // 筛选数据：仅保留 operation 为 0 的项\n        const filteredData = res.data.data.data.filter(\n          (item) => item.operation === 0\n        );\n\n        // 映射数据，格式化并追加到 data.value\n        data.value.push(\n          ...filteredData.map((item, index) => ({\n            key: item.id,\n            index: pagination.current * pagination.pageSize - pagination.pageSize + index + 1, \n            taskTag: item.type,\n            taskDetail: item.detail,\n            submitTime: item.presentDate,\n            operation: item.operation,\n            evaluatedName: item.evaluatedName,\n            department: item.department,\n          }))\n        );\n      } else {\n        // 处理非成功响应\n        message.error(\"获取失败！\" + res.data.msg);\n      }\n    })\n    .catch((err) => {\n      // 捕获并处理请求错误\n      message.error(\"请求失败，请稍后重试！\");\n    });\n};\n\n// 设置三种任务标签的颜色\nconst getTagColor = (taskTag) => {\n  if (taskTag === \"添加评估人审批\") return \"cyan\";\n  if (taskTag === \"添加被评估人审批\") return \"orange\";\n  if (taskTag === \"周边评议\") return \"purple\";\n  return \"green\";\n};\n// 调用api-进行单条任务的同意\nconst handleAgreeOne = (record) => {\n  // 1、获取传入接口的任务id\n  // 2、调用单条同意接口\n  message.success(\"同意成功！\");\n};\n// 处理翻页\nconst handleTableChange = (e) => {\n  pagination.current = Number(e.current); //更新当前页码\n  pagination.pageSize = e.pageSize; //更新每页显示条目数\n  sessionStorage.setItem(\"currentIndex\", pagination.current);\n  getTodoList(); // 重新获取列表数据\n};\nconst openRefuse = ref(false); //拒绝理由输入框默认不展示\nconst showModal = () => {\n  openRefuse.value = true;\n};\nconst handleEnterQues = (record) => {\n  // 1、获取record中的被评估人信息（姓名+部门）\n  const evaluatedName = record.evaluatedName;\n  const department = record.department;\n  const todoListId = record.key;\n  // 2、通过session传递信息\n  sessionStorage.setItem(\"evaluatedName\", evaluatedName);\n  sessionStorage.setItem(\"department\", department);\n  sessionStorage.setItem(\"todoListId\", todoListId);\n  // 3、页面跳转\n  if (localStorage.getItem(\"userRole\") === \"0\") {\n    router.push({\n      path: \"/quesnaireEdit\",\n    });\n  } else {\n    router.push({\n      path: \"/quesnaireEditAd\",\n    });\n  }\n};\nconst openDetail = ref(false); //查看详情弹窗默认不展示\nconst showDetail = () => {\n  openDetail.value = true;\n};\nconst openEvaluator = ref(false); //添加被评估人弹窗默认不展示\nconst showEvaluator = () => {\n  openEvaluator.value = true;\n};\nconst evaluator = ref([]);\nconst options = ref([]);\n// 获取人员列表\nconst getUserList = () => {\n  getUserListApi()\n    .then((res) => {\n      if (res.data.code === 200) {\n        options.value = [];\n        for (let i = 0; i <= res.data.data.length - 1; i++) {\n          options.value.push({\n            value:\n              res.data.data[i].name + \"(\" + res.data.data[i].department + \")\",\n            key: res.data.data[i].userId,\n          });\n        }\n      } else {\n        message.error(\"获取失败！\" + res.data.msg);\n      }\n    })\n    .catch((err) => {\n      message.error(\"请求失败！\"+ err);\n    });\n};\n// 调用api-将选择的被评估人key值传给后端\nconst isSubmitting = ref(false);\nconst handleEvaluatorOk = () => {\n  if (isSubmitting.value) {\n        message.warning(\"正在提交中，请勿重复提交！\");\n        return; // 正在提交中，直接返回，避免重复提交\n    }\n  isSubmitting.value = true;\n  // 1、获取被评估人key值\n  const selectedKeys = evaluator.value.map(\n    (item) => options.value.find((opt) => opt.value === item).key\n  );\n  if (selectedKeys.length === 0) {\n    message.warn(\"您还未选择被评估人哦𖦹𖦹 .ᐟ.ᐟ \");\n    return;\n  }\n  if (selectedKeys.length > 3) {\n    message.warn(\"最多只能选择三个被评估人哦𖦹𖦹 .ᐟ.ᐟ \");\n    return;\n  }\n  // 2、调用添加被评估人接口（若添加成功，清除evaluator值）\n  getEvaluatedListApi(selectedKeys)\n    .then((res) => {\n      if (res.data.code === 200) {\n        message.success(\"添加成功！\");\n        evaluator.value = [];\n        getAssessor(); // 刷新被评估人表格\n        getTodoList(); // 刷新待办表格\n        openEvaluator.value = false; // 3、关闭弹窗\n      } else {\n        message.error(\"添加失败！\" + res.data.msg);\n      }\n    })\n    .catch((err) => {\n      message.error(\"请求失败！\"+ err);\n    })\n    .finally(() => {\n      isSubmitting.value = false; // 无论成功还是失败，都将提交状态置为 false\n    });\n};\n\n// 添加自主评估人相关配置\nconst columnsDetail = ref([\n  {\n    title: \"序号\",\n    dataIndex: \"index\",\n    key: \"index\",\n    align: \"center\",\n  },\n  {\n    title: \"姓名\",\n    dataIndex: \"username\",\n    key: \"username\",\n    align: \"center\",\n  },\n  {\n    title: \"部门\",\n    dataIndex: \"department\",\n    key: \"department\",\n    align: \"center\",\n  },\n]);\nconst dataDetail = ref([]);\nconst getAssessor = () => {\n  getAssessorApi()\n    .then((res) => {\n      if (res.data.code === 200) {\n        dataDetail.value = [];\n        for (let i = 0; i <= res.data.data.length - 1; i++) {\n          dataDetail.value.push({\n            index: i + 1,\n            username: res.data.data[i].username,\n            department: res.data.data[i].department,\n          });\n        }\n      } else {\n        message.error(\"获取失败！\" + res.data.msg);\n      }\n    })\n    .catch((err) => {\n      message.error(\"请求失败！\"+ err);\n    });\n};\n\n// 获取当前时间并格式化\nconst getCurrentDateTime = () => {\n  const now = new Date();\n  const year = now.getFullYear();\n  const month = (now.getMonth() + 1).toString().padStart(2, \"0\"); // 月份是从0开始的\n  const day = now.getDate().toString().padStart(2, \"0\");\n  return `${year}-${month}-${day}`;\n};\n\n// 导出打分情况\nconst exportData = () => {\n  getExportSelfDataApi()\n    .then((res) => {\n      // 判断响应是否为文件流\n      if (res && res.data) {\n        const blob = new Blob([res.data], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });\n        const link = document.createElement('a');\n        const url = URL.createObjectURL(blob);\n\n        // 使用当前日期来动态生成文件名\n        const fileName = `本轮全部打分情况${getCurrentDateTime()}.xlsx`;\n\n        link.href = url;\n        link.download = fileName;  // 设置文件名\n        link.click();  // 触发下载\n        message.success(\"本轮全部打分情况导出成功！\");\n      } else {\n        message.error(\"导出失败！未知错误\");\n      }\n    })\n    .catch((err) => {\n      console.error('请求失败：', err);\n      message.error(\"请求失败！\");\n    });\n}\n\n// 导出待评分列表\nconst exportEvaluatedInfo = () => {\n  getExportEvaluatedInfoApi()\n    .then((res) => {\n      // 判断响应是否为文件流\n      if (res && res.data) {\n        const blob = new Blob([res.data], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });\n        const link = document.createElement('a');\n        const url = URL.createObjectURL(blob);\n\n        // 使用当前日期来动态生成文件名\n        const fileName = `待评分列表${getCurrentDateTime()}.xlsx`;\n\n        link.href = url;\n        link.download = fileName;  // 设置文件名\n        link.click();  // 触发下载\n        message.success(\"待评分列表导出成功！\");\n      } else {\n        message.error(\"导出失败！未知错误\");\n      }\n    })\n    .catch((err) => {\n      console.error('请求失败：', err);\n      message.error(\"请求失败！\");\n    });\n}\n</script>\n\n<template>\n  <div class=\"todoList-container\">\n    <div class=\"left\">\n      <!-- 标题区域 -->\n      <div class=\"title\">\n        <span v-if=\"notDone!==0\">我的待办&ensp;<span class=\"not-done\">未完成：{{ notDone }}</span></span>\n        <span v-else>我的待办&ensp;<span class=\"all-done\">已经完成打分任务</span></span>\n        <span>\n          <a-button type=\"primary\" style=\"margin-right:10px;\" @click=\"exportEvaluatedInfo\" :disabled=\"isVisible\">\n            导出待评分列表\n          </a-button>\n          <a-button type=\"primary\" style=\"background-color: #39ba06;\" @click=\"exportData\">\n            导出打分情况\n          </a-button>\n        </span>\n      </div>\n      <!-- 内容区域 -->\n      <div class=\"todoTable\">\n        <!-- 待办表格 -->\n        <a-table\n          :columns=\"columns\"\n          :data-source=\"data\"\n          :rowKey=\"(record) => record.key\"\n          :scroll=\"{ y: scrollHeight }\"\n          :pagination=\"pagination\"\n          :bordered=\"true\"\n          @change=\"handleTableChange\"\n        >\n          <template #bodyCell=\"{ column, record }\">\n            <!-- 设置三种任务标签的颜色 -->\n            <template v-if=\"column.key === 'taskTag'\">\n              <span>\n                <a-tag\n                  :key=\"record.taskTag\"\n                  :color=\"getTagColor(record.taskTag)\"\n                >\n                  {{ record.taskTag }}\n                </a-tag>\n              </span>\n            </template>\n            <!-- 设置操作栏 -->\n            <template v-if=\"column.key === 'action'\">\n              <span v-if=\"record.taskTag === '添加评估人审批'\">\n                <a\n                  style=\"color: #0014b7; text-decoration: underline\"\n                  @click=\"showDetail\"\n                  >查看详情</a\n                >\n                <a-divider type=\"vertical\" />\n                <a style=\"color: #bd3124; font-weight: bold\" @click=\"showModal\"\n                  >拒绝</a\n                >\n              </span>\n              <span v-else-if=\"record.taskTag === '添加被评估人审批'\">\n                <a\n                  style=\"color: #3f9373; font-weight: bold\"\n                  @click=\"handleAgreeOne(record)\"\n                  >同意</a\n                >\n                <a-divider type=\"vertical\" />\n                <a style=\"color: #bd3124; font-weight: bold\" @click=\"showModal\"\n                  >拒绝</a\n                >\n              </span>\n              <span v-else-if=\"record.taskTag === '周边评议'\">\n                <a\n                  style=\"color: #3f9373; font-weight: bold\"\n                  @click=\"handleEnterQues(record)\"\n                  >进入评议</a\n                >\n              </span>\n            </template>\n          </template>\n        </a-table>\n      </div>\n    </div>\n    <div class=\"right\">\n      <a-button type=\"primary\" @click=\"showEvaluator\"> 我要评估 </a-button>\n      <!-- 我要评估表格 -->\n      <div style=\"margin-top: 10px\">\n        <a-table\n          :columns=\"columnsDetail\"\n          :data-source=\"dataDetail\"\n          :bordered=\"false\"\n          :pagination=\"false\"\n          :scroll=\"{ y: '60vh' }\"\n        >\n        </a-table>\n      </div>\n\n      <!-- 添加被评估人弹窗 -->\n      <a-modal\n        v-model:open=\"openEvaluator\"\n        title=\"添加被评估人\"\n        @ok=\"handleEvaluatorOk\"\n      >\n        <span style=\"color: #bd3124\">注：您可以自主选择1-3个要评估的人</span>\n        <a-select\n          v-model:value=\"evaluator\"\n          :options=\"options\"\n          mode=\"multiple\"\n          placeholder=\"请选择\"\n          style=\"width: 100%\"\n        >\n        </a-select>\n      </a-modal>\n    </div>\n  </div>\n</template>\n\n<style lang=\"less\" scoped>\n.todoList-container {\n  // border: 1px solid red;\n  display: flex;\n  width: 100%;\n  height: 100%;\n  gap: 10px;\n}\n\n.left {\n  border: 1.5px dashed rgba(128, 191, 255, 0.7);\n  width: 70%;\n  padding: 10px 10px 0px 10px;\n  /* 给左侧区域加点内边距 */\n\n  .title {\n    // border: 1px solid blue;\n    height: 35px;\n    display: flex;\n    justify-content: space-between;\n    margin: 0px 10px 10px 10px;\n\n    .not-done {\n        font-weight: bold;\n        color: #dc3545; // key 部分改为蓝色\n        background-color: #f8d7da; // 给key部分加背景色，改为淡蓝色\n        padding: 5px 8px;\n        border-radius: 4px;\n      }\n    \n    .all-done {\n      font-weight: bold;\n      color: #28a745; // key 部分改为蓝色\n      background-color: #d4edda; // 给key部分加背景色，改为淡蓝色\n      padding: 5px 8px;\n      border-radius: 4px;\n    }\n\n    span {\n      font-size: 16px;\n      font-weight: bold;\n      display: flex;\n      align-items: center;\n    }\n  }\n\n  .todoTable {\n    height: calc(100% - 35px - 10px);\n    max-height: calc(100% - 35px - 10px);\n    // border: 1px solid red;\n    margin: 0 10px 0 10px;\n    overflow: hidden;\n    /* 防止滚动条溢出 */\n  }\n\n  ::v-deep .ant-table-tbody>tr>td {\n    padding: 13px 5px;\n  }\n\n  ::v-deep .ant-table-thead>tr>th {\n    padding: 13px 5px;\n  }\n}\n\n.right {\n  // border: 1px solid orange;\n  width: 30%;\n  padding: 15px;\n  background-color: rgba(179, 217, 255, 0.3);\n  box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.1);\n  display: flex;\n  flex-direction: column;\n  justify-content: flex-start;\n  align-items: flex-start;\n\n  ::v-deep .ant-table-thead>tr>th {\n    padding: 13px 5px;\n  }\n}\n</style>","import script from \"./TodoList.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./TodoList.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./TodoList.vue?vue&type=style&index=0&id=e7093a44&lang=less&scoped=true\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_@vue+compiler-sfc@3.5.13_vue@3.5.13_webpack@5.95.0/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-e7093a44\"]])\n\nexport default __exports__"],"names":["getTodoListApi","pageNum","pageSize","Promise","resolve","reject","axios","method","url","headers","params","then","response","catch","error","getUserListApi","getEvaluatedListApi","userIds","data","JSON","stringify","getAssessorApi","getExportSelfDataApi","responseType","getExportEvaluatedInfoApi","onMounted","getTodoList","getUserList","updateScrollHeight","getStepTime","window","addEventListener","getAssessor","isVisible","ref","currentSession","getStepTimeApi","res","code","i","evaluateStep","length","enable","value","message","msg","err","console","log","onUnmounted","removeEventListener","scrollHeight","router","useRouter","pagination","reactive","current","showSizeChanger","total","showTotal","range","columns","title","dataIndex","key","width","align","screenHeight","innerHeight","containerHeight","notDone","splice","sessionStorage","getItem","filteredData","filter","item","operation","push","map","index","id","taskTag","type","taskDetail","detail","submitTime","presentDate","evaluatedName","department","getTagColor","handleAgreeOne","record","success","handleTableChange","e","Number","setItem","openRefuse","showModal","handleEnterQues","todoListId","localStorage","path","openDetail","showDetail","openEvaluator","showEvaluator","evaluator","options","name","userId","isSubmitting","handleEvaluatorOk","warning","selectedKeys","find","opt","warn","finally","columnsDetail","dataDetail","username","getCurrentDateTime","now","Date","year","getFullYear","month","getMonth","toString","padStart","day","getDate","exportData","blob","Blob","link","document","createElement","URL","createObjectURL","fileName","href","download","click","exportEvaluatedInfo","__exports__"],"sourceRoot":""}