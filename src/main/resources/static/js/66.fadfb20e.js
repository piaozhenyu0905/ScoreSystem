"use strict";(self["webpackChunkscoring_system_front"]=self["webpackChunkscoring_system_front"]||[]).push([[66],{41:function(e,a,t){t.d(a,{XD:function(){return r},_8:function(){return i},q6:function(){return l}});var n=t(5857);const r=(e,a)=>new Promise(((t,r)=>{(0,n.A)({method:"get",url:"/api/todolist",headers:{"Content-Type":"application/json"},params:{pageNum:e,pageSize:a}}).then((e=>{t(e)})).catch((e=>{r(e.response)}))})),i=()=>new Promise(((e,a)=>{(0,n.A)({method:"get",url:"/api/findAll",headers:{"Content-Type":"application/json"}}).then((a=>{e(a)})).catch((e=>{a(e.response)}))})),l=e=>new Promise(((a,t)=>{let r={userIds:e};(0,n.A)({method:"post",url:"/api/add/evaluated",headers:{"Content-Type":"application/json"},data:JSON.stringify(r)}).then((e=>{a(e)})).catch((e=>{t(e.response)}))}))},2066:function(e,a,t){t.r(a),t.d(a,{default:function(){return C}});t(9138),t(1531),t(3678),t(4145);var n=t(5115),r=t(7296),i=t(9650),l=t(9675),o=t(3771),s=(t(3369),t(5857));const d=(e,a,t)=>new Promise(((n,r)=>{let i={name:t,pageNum:e,pageSize:a};(0,s.A)({method:"post",url:"/api/find/relationships",headers:{"Content-Type":"application/json"},data:JSON.stringify(i)}).then((e=>{n(e)})).catch((e=>{r(e.response)}))})),u=(e,a)=>new Promise(((t,n)=>{let r={evaluatorIds:e,userId:a};(0,s.A)({method:"post",url:"/api/add/relationship",headers:{"Content-Type":"application/json"},data:JSON.stringify(r)}).then((e=>{t(e)})).catch((e=>{n(e.response)}))})),p=(e,a)=>new Promise(((t,n)=>{(0,s.A)({method:"delete",url:"/api/update/relationship",headers:{"Content-Type":"application/json"},params:{evaluatorId:e,userId:a}}).then((e=>{t(e)})).catch((e=>{n(e.response)}))})),c=e=>new Promise(((a,t)=>{let n=new FormData;n.append("file",e),(0,s.A)({method:"post",url:"/api/import/relationship",headers:{"Content-Type":"multipart/form-data"},data:n}).then((e=>{a(e)})).catch((e=>{t(e.response)}))})),m=()=>new Promise(((e,a)=>{(0,s.A)({method:"get",url:"/api/relation/step",headers:{"Content-Type":"application/json"}}).then((a=>{e(a)})).catch((e=>{a(e.response)}))}));var h=t(41),v=t(543);const y={class:"score-matrix"},g={class:"content-header"},f={class:"search-form"},k={class:"submit-Btn"},x={class:"content-table"},b={class:"actionBtn"};var w={__name:"ScoringMatrix",setup(e){const a=(0,l.KR)(!1),s=(0,l.KR)(),w=()=>{(0,v.Q)().then((e=>{if(200===e.data.code)for(let t=0;t<=e.data.data.evaluateStep.length-1;t++)1===e.data.data.evaluateStep[t].enable&&(s.value=t+1+"","1"===s.value?a.value=!1:a.value=!0);else o.Ay.error("获取失败！"+e.data.msg)})).catch((e=>{console.log("获取失败！",e)}))},F=(0,l.Kh)({name:null}),_=(0,l.KR)(null),C=()=>{A.current=1,K()},A=(0,l.Kh)({pageSize:12,current:1,showSizeChanger:!1,total:0,showTotal:(e,a)=>`总共 ${e} 条数据`}),N=(0,l.KR)([{title:"序号",dataIndex:"index",key:"index",fixed:"left",align:"center",width:65},{title:"被评估人",dataIndex:"name",key:"name",fixed:"left",align:"center",width:100},{title:"主管1",dataIndex:"supervisorName1",key:"supervisorName1",align:"center",width:100},{title:"主管2",dataIndex:"supervisorName2",key:"supervisorName2",align:"center",width:100},{title:"主管3",dataIndex:"supervisorName3",key:"supervisorName3",align:"center",width:100},{title:"主管4",dataIndex:"supervisorName4",key:"supervisorName4",align:"center",width:100},{title:"固定评估人",dataIndex:"relationshipFixed",key:"relationshipFixed",align:"center"},{title:"自主评估人",dataIndex:"relationshipSelf",key:"relationshipSelf",align:"center"},{title:"操作",key:"action",fixed:"right",align:"center",width:160}]),S=(0,l.KR)([]),I=(0,l.KR)("60vh"),L=()=>{const e=window.innerHeight,a=e-50-10;I.value=e<800?.62*a+"px":.7*a+"px"},K=()=>{d(A.current,A.pageSize,F.name).then((e=>{if(200===e.data.code){A.total=e.data.data.total,S.value=[];for(let a=0;a<e.data.data.data.length;a++){const t=e.data.data.data[a].relationshipFixedList||[],n=e.data.data.data[a].relationshipSelfList||[],r=t.map((e=>e.name)).join("、"),i=n.map((e=>e.name)).join("、");S.value.push({index:A.current*A.pageSize-A.pageSize+a+1,userId:e.data.data.data[a].userId,name:e.data.data.data[a].name,supervisorName1:e.data.data.data[a].supervisorName1,supervisorName2:e.data.data.data[a].supervisorName2,supervisorName3:e.data.data.data[a].supervisorName3,supervisorName4:e.data.data.data[a].supervisorName4,relationshipFixedList:e.data.data.data[a].relationshipFixedList,relationshipSelfList:e.data.data.data[a].relationshipSelfList,relationshipFixed:r,relationshipSelf:i})}}})).catch((e=>{o.Ay.error("请求失败！",e)}))},R=e=>{A.current=Number(e.current),A.pageSize=e.pageSize,K()},j=(0,l.KR)(!1),z=(0,l.KR)([{title:"序号",dataIndex:"index",key:"index",width:"15%",align:"center"},{title:"用户名",dataIndex:"username",key:"username",align:"center"},{title:"工号",dataIndex:"jobuNumber",key:"jobuNumber",align:"center"},{title:"部门",dataIndex:"department",key:"department",align:"center"},{title:"操作",key:"action",width:"15%",align:"center"}]),W=(0,l.KR)([]),T=e=>{_.value=e.userId,W.value=[];for(let a=0;a<e.relationshipFixedList.length;a++)W.value.push({index:a+1,key:e.relationshipFixedList[a].id,username:e.relationshipFixedList[a].name,jobuNumber:e.relationshipFixedList[a].workNum,department:e.relationshipFixedList[a].department});j.value=!0},P=e=>{const a=W.value.findIndex((a=>a.key===e.key));p(e.key,_.value).then((e=>{200===e.data.code?(o.Ay.success("删除成功！"),-1!==a&&W.value.splice(a,1),K()):o.Ay.error("删除失败！"+e.data.msg)})).catch((e=>{o.Ay.error("请求失败！",e)}))},X=(0,l.KR)(!1),$=()=>{O(),X.value=!0},D=(0,l.KR)([]),E=(0,l.KR)([]),O=()=>{(0,h._8)().then((e=>{if(200===e.data.code){E.value=[{label:"空值",value:0}];for(let a=0;a<=e.data.data.length-1;a++)E.value.push({label:e.data.data[a].name+"("+e.data.data[a].department+")",value:e.data.data[a].userId,name:e.data.data[a].name})}else o.Ay.error("获取失败！"+e.data.msg)})).catch((e=>{o.Ay.error("请求失败！",e)}))},U=()=>{const e=Object.values(D.value);0!==e.length?u(e,_.value).then((e=>{200===e.data.code?(o.Ay.success("添加固定评估人成功！^_^"),D.value=[],K(),X.value=!1,j.value=!1):o.Ay.error(e.data.msg)})).catch((e=>{console.log("请求失败！",e)})):o.Ay.error("请选择评估人！")},Q=(0,l.KR)(null),B=(0,l.KR)(!1),J=()=>{Q.value.click()},M=e=>{const a=e.target.files[0];a&&(B.value=!0,c(a).then((e=>{B.value=!1,200===e.data.code?(o.Ay.success("文件上传成功~ =• ֊ •="),setTimeout((()=>{location.reload()}),500)):o.Ay.error("文件上传失败，"+e.data.msg+"~Z☡zᶻ")})).catch((e=>{B.value=!1,o.Ay.error("文件上传失败"+e)})))},q=()=>{const e=new Date,a=e.getFullYear(),t=(e.getMonth()+1).toString().padStart(2,"0"),n=e.getDate().toString().padStart(2,"0");return`${a}-${t}-${n}`},H=()=>{const e=q(),a=new URL(t(353),t.b).href,n=document.createElement("a");n.href=a,n.download=`用户信息模板${e}.xlsx`,n.click()},V=()=>{m().then((e=>{200===e.data.code?(o.Ay.success("您已发布本轮评估矩阵关系!"),a.value=!0):o.Ay.error("发布失败！"+e.data.msg)})).catch((e=>{o.Ay.error("请求失败！"+e)}))};return(0,n.sV)((()=>{K(),w(),L(),window.addEventListener("resize",L)})),(0,n.hi)((()=>{window.removeEventListener("resize",L)})),(e,t)=>{const l=(0,n.g2)("a-input"),o=(0,n.g2)("a-form-item"),s=(0,n.g2)("a-button"),d=(0,n.g2)("a-form"),u=(0,n.g2)("a-popconfirm"),p=(0,n.g2)("a-spin"),c=(0,n.g2)("a-table"),m=(0,n.g2)("a-modal"),h=(0,n.g2)("a-select");return(0,n.uX)(),(0,n.CE)("div",y,[(0,n.Lk)("div",g,[(0,n.Lk)("div",f,[(0,n.bF)(d,{style:{display:"flex","align-items":"center"}},{default:(0,n.k6)((()=>[(0,n.bF)(o,{style:{"margin-right":"10px",width:"300px"}},{default:(0,n.k6)((()=>[(0,n.bF)(l,{placeholder:"请输入被评估人姓名",value:F.name,"onUpdate:value":t[0]||(t[0]=e=>F.name=e),allowClear:!0},null,8,["value"])])),_:1}),(0,n.bF)(o,null,{default:(0,n.k6)((()=>[(0,n.bF)(s,{type:"primary",onClick:(0,r.D$)(C,["prevent"]),class:"seachBtn"},{default:(0,n.k6)((()=>t[5]||(t[5]=[(0,n.eW)("搜索")]))),_:1})])),_:1})])),_:1})]),(0,n.Lk)("div",k,[(0,n.bF)(s,{type:"primary",style:{"margin-right":"10px"},onClick:J},{default:(0,n.k6)((()=>t[6]||(t[6]=[(0,n.eW)("导入数据")]))),_:1}),(0,n.bF)(s,{type:"primary",style:{"margin-right":"10px"},onClick:H},{default:(0,n.k6)((()=>t[7]||(t[7]=[(0,n.eW)("导出模板")]))),_:1}),(0,n.bF)(u,{placement:"bottom",title:"确定要发布本轮矩阵关系吗？","ok-text":"确定","cancel-text":"取消",onConfirm:t[1]||(t[1]=e=>V())},{default:(0,n.k6)((()=>[a.value?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.Wv)(s,{key:0,type:"primary",style:{"background-color":"#39ba06"}},{default:(0,n.k6)((()=>t[8]||(t[8]=[(0,n.eW)(" 发布 ")]))),_:1}))])),_:1}),a.value?((0,n.uX)(),(0,n.Wv)(s,{key:0,type:"primary",disabled:""},{default:(0,n.k6)((()=>t[9]||(t[9]=[(0,n.eW)(" 已发布 ")]))),_:1})):(0,n.Q3)("",!0),(0,n.Lk)("input",{ref_key:"fileInput",ref:Q,type:"file",accept:".xls,.xlsx",style:{display:"none"},onChange:M},null,544),(0,n.bF)(p,{spinning:B.value,class:"loading-spin",size:"large"},null,8,["spinning"])])]),(0,n.Lk)("div",x,[(0,n.bF)(c,{columns:N.value,"data-source":S.value,rowKey:e=>e.key,scroll:{y:I.value},pagination:A,bordered:!0,onChange:R},{bodyCell:(0,n.k6)((({text:e,record:a,column:r})=>["action"===r.key?((0,n.uX)(),(0,n.Wv)(s,{key:0,type:"text",onClick:e=>T(a),style:{color:"#0014b7"}},{default:(0,n.k6)((()=>t[10]||(t[10]=[(0,n.eW)("修改固定评估人")]))),_:2},1032,["onClick"])):((0,n.uX)(),(0,n.CE)(n.FK,{key:1},[(0,n.eW)((0,i.v_)(e),1)],64))])),_:1},8,["columns","data-source","rowKey","scroll","pagination"]),(0,n.bF)(m,{open:j.value,"onUpdate:open":t[2]||(t[2]=e=>j.value=e),title:"修改固定评估人",footer:null},{default:(0,n.k6)((()=>[(0,n.bF)(c,{columns:z.value,"data-source":W.value,bordered:!0,pagination:!1,scroll:{y:"60vh"}},{bodyCell:(0,n.k6)((({column:e,record:a})=>["action"===e.key?((0,n.uX)(),(0,n.Wv)(u,{key:0,title:"确定要移除吗？","ok-text":"确定","cancel-text":"取消",onConfirm:e=>P(a)},{default:(0,n.k6)((()=>t[11]||(t[11]=[(0,n.Lk)("a",{style:{color:"#bd3124","font-weight":"bold"}}," 移除 ",-1)]))),_:2},1032,["onConfirm"])):(0,n.Q3)("",!0)])),_:1},8,["columns","data-source"]),(0,n.Lk)("div",b,[(0,n.bF)(s,{type:"primary",onClick:$},{default:(0,n.k6)((()=>t[12]||(t[12]=[(0,n.eW)("添加评估人")]))),_:1})])])),_:1},8,["open"]),(0,n.bF)(m,{open:X.value,"onUpdate:open":t[4]||(t[4]=e=>X.value=e),title:"添加评估人",onOk:U},{default:(0,n.k6)((()=>[(0,n.bF)(h,{value:D.value,"onUpdate:value":t[3]||(t[3]=e=>D.value=e),options:E.value,mode:"multiple",placeholder:"请选择",style:{width:"100%"}},null,8,["value","options"])])),_:1},8,["open"])])])}}},F=t(2965);const _=(0,F.A)(w,[["__scopeId","data-v-4551262c"]]);var C=_},353:function(e,a,t){e.exports=t.p+"ce1d8f46c664b815.xlsx"}}]);
//# sourceMappingURL=66.fadfb20e.js.map