"use strict";(self["webpackChunkscoring_system_front"]=self["webpackChunkscoring_system_front"]||[]).push([[817],{41:function(e,a,t){t.d(a,{AV:function(){return l},XD:function(){return o},_8:function(){return r},q6:function(){return s}});var n=t(5857);const o=(e,a)=>new Promise(((t,o)=>{(0,n.A)({method:"get",url:"/api/todolist",headers:{"Content-Type":"application/json"},params:{pageNum:e,pageSize:a}}).then((e=>{t(e)})).catch((e=>{o(e.response)}))})),r=()=>new Promise(((e,a)=>{(0,n.A)({method:"get",url:"/api/findAll",headers:{"Content-Type":"application/json"}}).then((a=>{e(a)})).catch((e=>{a(e.response)}))})),s=e=>new Promise(((a,t)=>{let o={userIds:e};(0,n.A)({method:"post",url:"/api/add/evaluated",headers:{"Content-Type":"application/json"},data:JSON.stringify(o)}).then((e=>{a(e)})).catch((e=>{t(e.response)}))})),l=()=>new Promise(((e,a)=>{(0,n.A)({method:"get",url:"/api/find/assessor",headers:{"Content-Type":"application/json"}}).then((a=>{e(a)})).catch((e=>{a(e.response)}))}))},4817:function(e,a,t){t.r(a),t.d(a,{default:function(){return L}});t(9138);var n=t(7616),o=t(5929),r=t(3e3),s=t(1516),l=t(4720),i=t(41);t(9314);const d={class:"todoList-container"},u={class:"left"},c={class:"title"},p={key:0},g={class:"not-done"},k={key:1},v={class:"todoTable"},y={key:0},m={key:0},h={key:1},f=["onClick"],b={key:2},w=["onClick"],C={class:"right"},A={style:{"margin-top":"10px"}};var I={__name:"TodoList",setup(e){(0,n.sV)((()=>{S(),Q(),L(),window.addEventListener("resize",L),J()}));(0,n.hi)((()=>{window.removeEventListener("resize",L)}));const a=(0,r.KR)("60vh"),t=(0,l.rd)(),I=(0,r.Kh)({pageSize:12,current:1,showSizeChanger:!1,total:0,showTotal:(e,a)=>`总共 ${e} 条数据`}),x=(0,r.KR)([{title:"序号",dataIndex:"index",key:"index",width:"10%",align:"center"},{title:"任务类型",dataIndex:"taskTag",key:"taskTag",width:"15%",align:"center"},{title:"任务详情",dataIndex:"taskDetail",key:"taskDetail",width:"30%",align:"center"},{title:"提交时间",dataIndex:"submitTime",key:"submitTime",align:"center"},{title:"操作",key:"action",align:"center"}]),T=(0,r.KR)([]),L=()=>{const e=window.innerHeight,t=e-35-10;a.value=e<800?.63*t+"px":.7*t+"px"},K=(0,r.KR)(),S=()=>{T.value.splice(0,T.value.length),sessionStorage.getItem("currentIndex")&&(I.current=sessionStorage.getItem("currentIndex")),(0,i.XD)(I.current,I.pageSize).then((e=>{if(200===e.data.code){I.total=e.data.data.total,K.value=e.data.data.total,T.value=[];const a=e.data.data.data.filter((e=>0===e.operation));T.value.push(...a.map(((e,a)=>({key:e.id,index:I.current*I.pageSize-I.pageSize+a+1,taskTag:e.type,taskDetail:e.detail,submitTime:e.presentDate,operation:e.operation,evaluatedName:e.evaluatedName,department:e.department}))))}else s.Ay.error("获取失败！"+e.data.msg)})).catch((e=>{s.Ay.error("请求失败，请稍后重试！")}))},_=e=>"添加评估人审批"===e?"cyan":"添加被评估人审批"===e?"orange":"周边评议"===e?"purple":"green",R=e=>{s.Ay.success("同意成功！")},E=e=>{I.current=Number(e.current),I.pageSize=e.pageSize,sessionStorage.setItem("currentIndex",I.current),S()},X=(0,r.KR)(!1),z=()=>{X.value=!0},F=e=>{const a=e.evaluatedName,n=e.department,o=e.key;sessionStorage.setItem("evaluatedName",a),sessionStorage.setItem("department",n),sessionStorage.setItem("todoListId",o),"0"===localStorage.getItem("userRole")?t.push({path:"/quesnaireEdit"}):t.push({path:"/quesnaireEditAd"})},N=(0,r.KR)(!1),D=()=>{N.value=!0},W=(0,r.KR)(!1),j=()=>{W.value=!0},q=(0,r.KR)([]),P=(0,r.KR)([]),Q=()=>{(0,i._8)().then((e=>{if(200===e.data.code){P.value=[];for(let a=0;a<=e.data.data.length-1;a++)P.value.push({value:e.data.data[a].name+"("+e.data.data[a].department+")",key:e.data.data[a].userId})}else s.Ay.error("获取失败！"+e.data.msg)})).catch((e=>{s.Ay.error("请求失败！"+e)}))},V=(0,r.KR)(!1),O=()=>{if(V.value)return void s.Ay.warning("正在提交中，请勿重复提交！");V.value=!0;const e=q.value.map((e=>P.value.find((a=>a.value===e)).key));0!==e.length?e.length>3?s.Ay.warn("最多只能选择三个被评估人哦𖦹𖦹 .ᐟ.ᐟ "):(0,i.q6)(e).then((e=>{200===e.data.code?(s.Ay.success("添加成功！"),q.value=[],J(),S(),W.value=!1):s.Ay.error("添加失败！"+e.data.msg)})).catch((e=>{s.Ay.error("请求失败！"+e)})).finally((()=>{V.value=!1})):s.Ay.warn("您还未选择被评估人哦𖦹𖦹 .ᐟ.ᐟ ")},U=(0,r.KR)([{title:"序号",dataIndex:"index",key:"index",align:"center"},{title:"姓名",dataIndex:"username",key:"username",align:"center"},{title:"部门",dataIndex:"department",key:"department",align:"center"}]),H=(0,r.KR)([]),J=()=>{(0,i.AV)().then((e=>{if(200===e.data.code){H.value=[];for(let a=0;a<=e.data.data.length-1;a++)H.value.push({index:a+1,username:e.data.data[a].username,department:e.data.data[a].department})}else s.Ay.error("获取失败！"+e.data.msg)})).catch((e=>{s.Ay.error("请求失败！"+e)}))};return(e,t)=>{const r=(0,n.g2)("a-tag"),s=(0,n.g2)("a-divider"),l=(0,n.g2)("a-table"),i=(0,n.g2)("a-button"),L=(0,n.g2)("a-select"),S=(0,n.g2)("a-modal");return(0,n.uX)(),(0,n.CE)("div",d,[(0,n.Lk)("div",u,[(0,n.Lk)("div",c,[0!==K.value?((0,n.uX)(),(0,n.CE)("span",p,[t[2]||(t[2]=(0,n.eW)("我的待办 ")),(0,n.Lk)("span",g,"未完成："+(0,o.v_)(K.value),1)])):((0,n.uX)(),(0,n.CE)("span",k,t[3]||(t[3]=[(0,n.eW)("我的待办 "),(0,n.Lk)("span",{class:"all-done"},"已经完成打分任务",-1)])))]),(0,n.Lk)("div",v,[(0,n.bF)(l,{columns:x.value,"data-source":T.value,rowKey:e=>e.key,scroll:{y:a.value},pagination:I,bordered:!0,onChange:E},{bodyCell:(0,n.k6)((({column:e,record:a})=>["taskTag"===e.key?((0,n.uX)(),(0,n.CE)("span",y,[((0,n.uX)(),(0,n.Wv)(r,{key:a.taskTag,color:_(a.taskTag)},{default:(0,n.k6)((()=>[(0,n.eW)((0,o.v_)(a.taskTag),1)])),_:2},1032,["color"]))])):(0,n.Q3)("",!0),"action"===e.key?((0,n.uX)(),(0,n.CE)(n.FK,{key:1},["添加评估人审批"===a.taskTag?((0,n.uX)(),(0,n.CE)("span",m,[(0,n.Lk)("a",{style:{color:"#0014b7","text-decoration":"underline"},onClick:D},"查看详情"),(0,n.bF)(s,{type:"vertical"}),(0,n.Lk)("a",{style:{color:"#bd3124","font-weight":"bold"},onClick:z},"拒绝")])):"添加被评估人审批"===a.taskTag?((0,n.uX)(),(0,n.CE)("span",h,[(0,n.Lk)("a",{style:{color:"#3f9373","font-weight":"bold"},onClick:e=>R(a)},"同意",8,f),(0,n.bF)(s,{type:"vertical"}),(0,n.Lk)("a",{style:{color:"#bd3124","font-weight":"bold"},onClick:z},"拒绝")])):"周边评议"===a.taskTag?((0,n.uX)(),(0,n.CE)("span",b,[(0,n.Lk)("a",{style:{color:"#3f9373","font-weight":"bold"},onClick:e=>F(a)},"进入评议",8,w)])):(0,n.Q3)("",!0)],64)):(0,n.Q3)("",!0)])),_:1},8,["columns","data-source","rowKey","scroll","pagination"])])]),(0,n.Lk)("div",C,[(0,n.bF)(i,{type:"primary",onClick:j},{default:(0,n.k6)((()=>t[4]||(t[4]=[(0,n.eW)(" 我要评估 ")]))),_:1}),(0,n.Lk)("div",A,[(0,n.bF)(l,{columns:U.value,"data-source":H.value,bordered:!1,pagination:!1,scroll:{y:"60vh"}},null,8,["columns","data-source"])]),(0,n.bF)(S,{open:W.value,"onUpdate:open":t[1]||(t[1]=e=>W.value=e),title:"添加被评估人",onOk:O},{default:(0,n.k6)((()=>[t[5]||(t[5]=(0,n.Lk)("span",{style:{color:"#bd3124"}},"注：您可以自主选择1-3个要评估的人",-1)),(0,n.bF)(L,{value:q.value,"onUpdate:value":t[0]||(t[0]=e=>q.value=e),options:P.value,mode:"multiple",placeholder:"请选择",style:{width:"100%"}},null,8,["value","options"])])),_:1},8,["open"])])])}}},x=t(3578);const T=(0,x.A)(I,[["__scopeId","data-v-071d31b6"]]);var L=T}}]);
//# sourceMappingURL=817.e3451017.js.map